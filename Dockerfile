FROM golang:1.18-alpine as builder

RUN apk update && apk add git ca-certificates && rm -rf /var/cache/apk/*

WORKDIR /dist

COPY ./ /dist/

RUN ./build.sh

FROM scratch

COPY --from=builder /dist/core.ledger.server /core.ledger.server
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt

# ENV_START
# Code generated by example generator. DO NOT EDIT.

ENV ASSETS=

ENV BATCH_SIZE=

ENV FORMAT=

ENV LOG_LEVEL=

ENV STATUSES=

ENV CLIENT_OPTIONS_ADDRESS=
ENV CLIENT_OPTIONS_AUTH=
ENV CLIENT_OPTIONS_CONFIG=
ENV CLIENT_OPTIONS_CURRENT_DATABASE=
ENV CLIENT_OPTIONS_DATABASE=
ENV CLIENT_OPTIONS_DIAL_OPTIONS=
ENV CLIENT_OPTIONS_DIR=
ENV CLIENT_OPTIONS_HEALTH_CHECK_RETRIES=
ENV CLIENT_OPTIONS_HEART_BEAT_FREQUENCY=
ENV CLIENT_OPTIONS_LOG_FILE_NAME=
ENV CLIENT_OPTIONS_MAX_RECV_MSG_SIZE=
ENV CLIENT_OPTIONS_METRICS=
ENV CLIENT_OPTIONS_MTLS=
ENV CLIENT_OPTIONS_PASSWORD=
ENV CLIENT_OPTIONS_PASSWORD_READER=
ENV CLIENT_OPTIONS_PID_PATH=
ENV CLIENT_OPTIONS_PORT=
ENV CLIENT_OPTIONS_SERVER_SIGNING_PUB_KEY=
ENV CLIENT_OPTIONS_STREAM_CHUNK_SIZE=
ENV CLIENT_OPTIONS_TOKEN_FILE_NAME=
ENV CLIENT_OPTIONS_USERNAME=

ENV SERVICE_ACCESS_LOGGER=
ENV SERVICE_DEVICE=
ENV SERVICE_METRICS=
ENV SERVICE_PORT=
ENV SERVICE_PRODUCTION=
ENV SERVICE_SERVERNAME=

ENV CLIENT_OPTIONS_MTLS_OPTIONS_CERTIFICATE=
ENV CLIENT_OPTIONS_MTLS_OPTIONS_CLIENT_CAS=
ENV CLIENT_OPTIONS_MTLS_OPTIONS_PKEY=
ENV CLIENT_OPTIONS_MTLS_OPTIONS_SERVERNAME=

ENV SERVICE_MTLS_CERTIFICATE=
ENV SERVICE_MTLS_CLIENT_CAS=
ENV SERVICE_MTLS_PKEY=
ENV SERVICE_MTLS_SERVERNAME=

# ENV_END

USER 65535
ENTRYPOINT [ "/core.ledger.server", "service" ]